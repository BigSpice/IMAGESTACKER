<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image to PDF Merger</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.4.0/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <style>
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
        }
        .app-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #2c2c2c;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .drop-zone {
            border: 2px dashed #444;
            padding: 20px;
            text-align: center;
            cursor: pointer;
        }
        .drop-zone-active {
            background-color: rgba(76, 175, 80, 0.1);
        }
        .image-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        .image-item {
            position: relative;
            width: 100px;
            height: 100px;
        }
        .image-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: 2px solid #444;
        }
        .remove-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255,0,0,0.7);
            color: white;
            border: none;
            padding: 2px 5px;
            cursor: pointer;
        }
        .progress-bar {
            width: 0%;
            height: 5px;
            background-color: #4CAF50;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const { useState, useRef } = React;
        const { PDFDocument } = window.PDFLib;

        function App() {
            const [images, setImages] = useState([]);
            const [progress, setProgress] = useState(0);
            const fileInputRef = useRef(null);

            const handleFileUpload = async (event) => {
                const files = event.target.files ? Array.from(event.target.files) : 
                               event.dataTransfer ? Array.from(event.dataTransfer.files) : [];
                
                const newImages = await Promise.all(
                    files.filter(file => file.type.startsWith('image/'))
                        .map(async (file) => ({
                            file,
                            url: await readFileAsDataURL(file),
                            id: Date.now() + Math.random().toString()
                        }))
                );
                
                setImages(prev => [...prev, ...newImages]);
            };

            const readFileAsDataURL = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            };

            const convertToPDF = async () => {
                const pdfDoc = await PDFDocument.create();
                
                for (let [index, image] of images.entries()) {
                    try {
                        const imgBytes = await fetch(image.url).then(res => res.arrayBuffer());
                        const img = await pdfDoc.embedImage(imgBytes);
                        const page = pdfDoc.addPage([img.width, img.height]);
                        page.drawImage(img, {
                            x: 0,
                            y: 0,
                            width: img.width,
                            height: img.height
                        });
                        setProgress(((index + 1) / images.length) * 100);
                    } catch (error) {
                        console.error(`Error processing image ${index}:`, error);
                    }
                }

                const pdfBytes = await pdfDoc.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'merged.pdf';
                link.click();
                setProgress(0);
            };

            const removeImage = (id) => {
                setImages(prev => prev.filter(img => img.id !== id));
            };

            const handleDragOver = (event) => {
                event.preventDefault();
                event.stopPropagation();
            };

            const handleDrop = (event) => {
                event.preventDefault();
                event.stopPropagation();
                handleFileUpload(event);
            };

            return React.createElement('div', { className: 'app-container' }, [
                React.createElement('h1', { key: 'title' }, 'Image to PDF Merger'),
                React.createElement('div', {
                    key: 'drop-zone',
                    className: 'drop-zone',
                    onClick: () => fileInputRef.current.click(),
                    onDragOver: handleDragOver,
                    onDrop: handleDrop
                }, [
                    React.createElement('input', {
                        key: 'file-input',
                        type: 'file',
                        multiple: true,
                        accept: 'image/*',
                        onChange: handleFileUpload,
                        ref: fileInputRef,
                        style: { display: 'none' }
                    }),
                    React.createElement('p', { key: 'drop-text' }, 
                        'Drag and drop images here or click to upload'
                    )
                ]),
                React.createElement('div', { 
                    key: 'image-list', 
                    className: 'image-list' 
                }, 
                    images.map((img) => 
                        React.createElement('div', { 
                            key: img.id, 
                            className: 'image-item' 
                        }, [
                            React.createElement('img', {
                                src: img.url,
                                className: 'image-thumbnail'
                            }),
                            React.createElement('button', {
                                className: 'remove-btn',
                                onClick: () => removeImage(img.id)
                            }, 'X')
                        ])
                    )
                ),
                React.createElement('button', {
                    key: 'convert-btn',
                    onClick: convertToPDF,
                    disabled: images.length === 0,
                    style: {
                        backgroundColor: images.length > 0 ? '#4CAF50' : '#777',
                        color: 'white',
                        border: 'none',
                        padding: '10px 20px',
                        borderRadius: '5px',
                        cursor: images.length > 0 ? 'pointer' : 'not-allowed'
                    }
                }, 'Convert to PDF'),
                React.createElement('div', {
                    key: 'progress-container',
                    style: { width: '100%', backgroundColor: '#333', height: '5px', marginTop: '10px' }
                }, [
                    React.createElement('div', {
                        key: 'progress-bar',
                        className: 'progress-bar',
                        style: { width: `${progress}%` }
                    })
                ])
            ]);
        }

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
