<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMAGESTACKER</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .mode-btn.active {
            background-color: #4CAF50;
            color: white;
        }

        .drop-zone {
            border: 2px dashed #ccc;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background-color: #fafafa;
            transition: border-color 0.3s ease;
        }

        .drop-zone.dragover {
            border-color: #000;
            background-color: #f0f0f0;
        }

        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .preview-item {
            position: relative;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: move;
        }

        .preview-item img {
            width: 100%;
            height: auto;
            border-radius: 2px;
        }

        .preview-item .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #45a049;
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .filename-input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .sort-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }

        #orderSelect {
            margin: 0 10px;
            padding: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            display: none;
        }

        .progress {
            width: 0%;
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }

        #sortableList {
            list-style-type: none;
            padding: 0;
        }

        #sortableList li {
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        #sortableList li img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
        }

        #sortableList li .filename {
            flex-grow: 1;
        }

        #sortableList li .remove-btn {
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="mode-toggle">
            <button class="mode-btn active" onclick="switchMode('showcase')">Showcase Mode</button>
            <button class="mode-btn" onclick="switchMode('combine')">Combine Mode</button>
        </div>

        <div id="showcaseMode">
            <div class="drop-zone" id="dropZone">
                <p>Drag and drop images here or</p>
                <input type="file" id="fileInput" multiple accept="image/*" style="display: none">
                <button class="btn" onclick="document.getElementById('fileInput').click()">Select Files</button>
            </div>

            <div class="preview-container" id="previewContainer"></div>
        </div>

        <div id="combineMode" style="display: none;">
            <div class="drop-zone" id="combineDropZone">
                <p>Drag and drop images here or</p>
                <input type="file" id="combineFileInput" multiple accept="image/*" style="display: none">
                <button class="btn" onclick="document.getElementById('combineFileInput').click()">Select Files</button>
            </div>

            <div class="sort-controls">
                <select id="orderSelect">
                    <option value="filename-asc">Sort by Filename (A-Z)</option>
                    <option value="filename-desc">Sort by Filename (Z-A)</option>
                    <option value="custom">Custom Order</option>
                </select>
                <button class="btn" onclick="sortFiles()">Sort</button>
            </div>

            <ul id="sortableList"></ul>
        </div>

        <input type="text" class="filename-input" id="pdfFilename" placeholder="Enter PDF filename (without extension)" value="converted_images">

        <div class="progress-bar" id="progressBar">
            <div class="progress" id="progress"></div>
        </div>

        <button class="btn" id="convertBtn" onclick="convertToPDF()" disabled>Convert to PDF</button>
    </div>

    <script>
        let selectedFiles = [];
        let currentMode = 'showcase';
        let sortableList = null;

        function switchMode(mode) {
            currentMode = mode;
            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('showcaseMode').style.display = mode === 'showcase' ? 'block' : 'none';
            document.getElementById('combineMode').style.display = mode === 'combine' ? 'block' : 'none';

            // Reset files when switching modes
            selectedFiles = [];
            document.getElementById('previewContainer').innerHTML = '';
            document.getElementById('sortableList').innerHTML = '';
            updateConvertButton();

            if (mode === 'combine') {
                initCombineSortable();
            }
        }

        function initCombineSortable() {
            const sortableContainer = document.getElementById('sortableList');
            sortableList = new Sortable(sortableContainer, {
                animation: 150,
                ghostClass: 'blue-background-class',
                onEnd: function() {
                    updateSelectedFilesFromList();
                }
            });
        }

        function handleFiles(files, mode) {
            if (mode === 'showcase') {
                files.forEach(file => {
                    if (!selectedFiles.some(f => f.name === file.name)) {
                        selectedFiles.push(file);
                        createPreviewItem(file, 'previewContainer');
                    }
                });
                updateConvertButton();
            } else {
                files.forEach(file => {
                    if (!selectedFiles.some(f => f.name === file.name)) {
                        selectedFiles.push(file);
                        createCombineListItem(file);
                    }
                });
                updateConvertButton();
            }
        }

        function createPreviewItem(file, containerId) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const previewContainer = document.getElementById(containerId);
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                const img = document.createElement('img');
                img.src = e.target.result;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '×';
                removeBtn.onclick = () => {
                    selectedFiles = selectedFiles.filter(f => f !== file);
                    previewItem.remove();
                    updateConvertButton();
                };
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                previewContainer.appendChild(previewItem);
            };
            reader.readAsDataURL(file);
        }

        function createCombineListItem(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const sortableContainer = document.getElementById('sortableList');
                const listItem = document.createElement('li');
                
                const img = document.createElement('img');
                img.src = e.target.result;
                
                const filename = document.createElement('span');
                filename.className = 'filename';
                filename.textContent = file.name;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '×';
                removeBtn.onclick = () => {
                    selectedFiles = selectedFiles.filter(f => f !== file);
                    listItem.remove();
                    updateConvertButton();
                };
                
                listItem.appendChild(img);
                listItem.appendChild(filename);
                listItem.appendChild(removeBtn);
                sortableContainer.appendChild(listItem);
            };
            reader.readAsDataURL(file);
        }

        function updateSelectedFilesFromList() {
            const sortableContainer = document.getElementById('sortableList');
            selectedFiles = Array.from(sortableContainer.children).map(li => 
                selectedFiles.find(f => f.name === li.querySelector('.filename').textContent)
            );
        }

        function sortFiles() {
            const orderSelect = document.getElementById('orderSelect');
            const sortableContainer = document.getElementById('sortableList');
            
            if (orderSelect.value === 'filename-asc') {
                selectedFiles.sort((a, b) => a.name.localeCompare(b.name));
            } else if (orderSelect.value === 'filename-desc') {
                selectedFiles.sort((a, b) => b.name.localeCompare(a.name));
            }
            
            // Rebuild the list
            sortableContainer.innerHTML = '';
            selectedFiles.forEach(file => createCombineListItem(file));
        }

        function updateConvertButton() {
            const convertBtn = document.getElementById('convertBtn');
            convertBtn.disabled = selectedFiles.length === 0;
        }

        // Drag and drop listeners for both modes
        ['dropZone', 'combineDropZone'].forEach(zoneId => {
            const dropZone = document.getElementById(zoneId);
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
                handleFiles(files, currentMode);
            });
        });

        // File input listeners for both modes
        ['fileInput', 'combineFileInput'].forEach(inputId => {
            const fileInput = document.getElementById(inputId);
            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files, inputId === 'fileInput' ? 'showcase' : 'combine');
            });
        });

        // PDF conversion (same as before)
        async function convertToPDF() {
            // [Previous PDF conversion code remains the same]
            // The only change is that selectedFiles will now be ordered 
            // according to the combine mode sorting
        }
    </script>
</body>
</html>
